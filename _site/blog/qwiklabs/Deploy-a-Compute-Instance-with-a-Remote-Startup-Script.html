<!DOCTYPE html>
<html>
  <head>
    <meta charset='UTF-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="msvalidate.01" content="9C87A2FE066C755406F5FFCAE1321439" />
    <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/css/style.css?v=" media="screen" type="text/css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print" type="text/css">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    
    

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>QLogbook: Deploy a Compute Instance with a Remote Startup Script | Chris KY FUNG's GitHub Page</title>
    <meta name="author" content=>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      <meta content="QLogbook: Deploy a Compute Instance with a Remote Startup Script | Chris KY FUNG's GitHub Page" property="og:title">
    
    
      <meta content="A step-by-step guilde for deploying a VM instance with automaticlly installing Apache web server package by using a Remote Startup Script on Google Cloud Platform." property="og:description">
    
    
      <meta content="http://localhost:4000/images/posts/qwiklabs/qwiklabs-GSP301-configure-startup-script-url-to-metadata.png" property="og:image">
    

  </head>

  <body>
    <header>
      <div class="inner">
        <a href="http://localhost:4000/">
          <h1>Chris KY FUNG's GitHub Page</h1>
        </a>
        <h2>Feel free to bookmark this to keep an eye on my project updates</h2>
        
        
      </div>
    </header>
	  
    <nav>
  <ul>
    
    <li><a href="/" >
      Home
    </a></li>
    
    <li><a href="/about.html" >
      About
    </a></li>
    
    <li><a href="/blog/index.html" >
      Blog
    </a></li>
    
    <li id="toggle-search"><i class="fas fa-search" onclick="toggleSearchBar()"></i></li>
  </ul>
</nav>
<script async src="https://cse.google.com/cse.js?cx=011006674894885990812:tjln7k0nyjx"></script>
<div class="gcse-search"></div>
<script>
  function toggleSearchBar() {
    var searchBar = document.querySelector("#___gcse_0");
    if ( searchBar.style.display == "block") {
      searchBar.style.display = "none";
    } else {
      searchBar.style.display = "block";
    }
  }
</script>
    <div id="content-wrapper">
	<div class="inner clearfix">
	<section id="main-content">
	  <h2 class="title">QLogbook: Deploy a Compute Instance with a Remote Startup Script</h2>

<div class="page-info">
	<span class="date"><info datetime="2019-09-20 00:00:00 +0000">
		20 Sep 2019  by Chris KY Fung 
	</info></span>
	<span class="page-tags">
		
		
		<a href="/tag/Qwiklabs"><code class="highligher-rouge"><nobr>Qwiklabs</nobr></code>&nbsp;</a>
		
		
		<a href="/tag/Google Cloud"><code class="highligher-rouge"><nobr>Google Cloud</nobr></code>&nbsp;</a>
		
		
		<a href="/tag/Logbook"><code class="highligher-rouge"><nobr>Logbook</nobr></code>&nbsp;</a>
		
	</span>
	<br><br>
	<!-- Go to www.addthis.com/dashboard to customize your tools -->
	<div class="addthis_inline_share_toolbox"></div>
</div>

<!-- Post content -->
<div class="notebody">
	<!--more-->

<p>If you read my <a href="/blog/qwiklabs/Google-Cloud-Essential-Skills-Challenge-Lab">last post</a>, you should know how to manually create a VM instance and configure it as an Apache2 web server with the web console in Google Cloud Platform (GCP). The steps are easy but you can automate and scale your web server installation process by adopting a <strong>Startup Script</strong>. Loading the startup script remotely from a cloud storage bucket is one method. The second lab of the challenge quest, <strong>GSP301</strong> <em>“<a href="https://www.qwiklabs.com/focuses/1735?parent=catalog">Deploy a Compute Instance with a Remote Startup Script</a>“</em>, is to test if you can deploy an Apache server to a VM instance with a remote startup script. You must know how to create a bucket and upload files to Google Cloud Storage, and configure the metadata in the dialog of creating an instance.</p>

<h2 id="brief-introduction-of-challenge-scenario">Brief Introduction of Challenge Scenario</h2>

<p>When you open the page of this lab in Qwiklabs, you can find the task requirements by click the green activity tracker (on the top right of the page) to expand the score box.</p>

<p><img src="/images/posts/qwiklabs/score_box_of_qwiklabs_GSP301.png" alt="Screenshot of Green Score box of Qwiklabs Hands-on-lab GSP301" /></p>
<p class="img-caption">Fig. Screenshot of Qwiklabs hands-on-lab GSP301 scorebox
</p>

<p>The screenshot above shows that there are 4 steps required for completing this lab. Combining with the instruction details, they are translated to the following mission statements.</p>

<ol>
  <li>
    <p>Create a Google Cloud Storage bucket, and confirm that the bucket contains a file.</p>
  </li>
  <li>
    <p>Create a Linux virtual machine that runs a remote startup script called <code class="highlighter-rouge">install-web.sh</code>  from cloud storage.</p>
  </li>
  <li>
    <p>Confirm that an HTTP access firewall rule exists with tag that applies to that virtual machine.</p>
  </li>
  <li>
    <p>Confirm the web server can be connected using HTTP and get a non-error response.</p>
  </li>
</ol>

<p><br /></p>

<p><img src="/images/posts/qwiklabs/qwiklab-GSP301-schematic.png" alt="Schematic diagram of Qwiklabs GSP301: Deploy a Compute Instance with a Remote Startup Script" /></p>
<p class="img-caption">Fig. Schematic diagram of GSP301: Deploy a Compute Instance with a Remote Startup Script</p>

<p><br /></p>

<h2 id="download-sample-startup-script">Download Sample Startup Script</h2>

<p>First of all, find <strong>Sample Startup Script</strong> below the Start button and the timer of the lab. Then, download the startup script file to your computer. This lab requires a minute for provisioning lab resources. You may make use of this interval to download the file or take a drink.</p>

<p><img src="/images/posts/qwiklabs/qwiklabs-GSP301-download-startup-script-file.png" alt="download sample startup script below the qwiklabs start button and lab timer" /></p>
<p class="img-caption">Fig. Download sample startup script below the Qwiklabs start button and lab timer</p>

<h2 id="upload-the-startup-script-to-a-cloud-storage-bucket">Upload the Startup Script to a Cloud Storage Bucket</h2>

<ol>
  <li>In the web console, navigate to <strong><em>Storage</em></strong>.</li>
  <li>Create a bucket with a unique bucket name.</li>
  <li>Upload the <code class="highlighter-rouge">install-web.sh</code> file to the bucket.</li>
  <li>
    <p>Make the file publicly accessible (This ensures the file can be access by the VM instance deployed soon).
 <br /><img src="/images/posts/qwiklabs/qwiklabs-GSP301-edit-file-permission-in-GCP-storage-bucket.png" alt="Edit the file permissions in Cloud Storage using GCP web console" /><br />
 Click the three dots (<i class="fas fa-ellipsis-v"></i>) icon at the right end of the filename. Choose <strong><em>Edit permissions</em></strong> in the dropdown menu.<br />
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-add-allusers-read-permission-to-install-web-sh.png" alt="Add allUsers and Reader access to the file" /><br />
Add a new <strong>User</strong>, type <code class="highlighter-rouge">allUsers</code> to the name field, and choose <strong>Reader</strong>.<br />
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-make-install-web-sh-publicly-accessible.png" alt="Confirm the install-web.sh file become pubilcly accessible" /><br /></p>
  </li>
  <li>Click the filename and copy the URL, i.e. <code class="highlighter-rouge">gs://.../install-web.sh</code> for later use.<br /><img src="/images/posts/qwiklabs/qwiklabs-GSP301-obtain-gs-url-startup-script-file.png" alt="Object details in Cloud Storage" /></li>
</ol>
<p class="img-caption">Fig. Confirm the startup script file become pubilcly accessible</p>

<h2 id="configure-metadata-in-creating-vm-instance">Configure Metadata in Creating VM instance</h2>

<ol>
  <li>Go to <strong><em>Compute Engine</em></strong>, create a new VM instance.</li>
  <li>Select <code class="highlighter-rouge">Allow HTTP traffic</code> under the Firewall section.
<img src="/images/posts/qwiklabs/qwiklabs-GSP101-step2-allow-HTTP-traffic-in-firewall-setting.png" alt="Firewall rule setting for creating a VM instance" /></li>
  <li>Expand <strong>Management, security, disks, networking, sole tenancy</strong>.</li>
  <li>In the Metadata section, add <code class="highlighter-rouge">startup-script-url</code> and paste the URL of the script file as the key value.
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-configure-startup-script-url-to-metadata.png" alt="Configure a remote startup script url to the metadata in Crate a VM instance page" />
If you want to learn more, please refer <a href="https://cloud.google.com/compute/docs/startupscript">Running Startup Scripts</a> in Compute Engine Documentation.
<br /></li>
  <li>Click <strong>Create</strong> to create the instance.
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-check-progress-created-instance-1.png" alt="Successfully created instance-1" /></li>
</ol>
<p class="img-caption">Fig. The new Compute Engine, `instance-1`</p>

<h2 id="inspect-instance-correctly-running-startup-script">Inspect Instance Correctly Running Startup Script</h2>

<ol>
  <li>Wait for the new VM instance startup.</li>
  <li>Click the instance name to open its Details tab. Then, expand the Logs and click <strong>Serial port 1 (console)</strong>.
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-view-serial-port-of-created-vm-instance.png" alt="Serial port logs showing in the Details tab of instance-1" /></li>
  <li>The startup script automatically installs the Apache web server software while creating the VM instance. You should able to find the log events about downloading the startup script and installing the apache packages.
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-logs-of-serial-port-1.png" alt="Serial Log: downloading startup script" /><br /><br />
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-apache-installation-in-logs-of-serial-port-1.png" alt="Serial Logs: installing Apache with startup script" /></li>
</ol>
<p class="img-caption">Fig. Logs that shows the execution of the startup script</p>

<ol>
  <li>Open the external IP in your web browser. You should view the Apache default page, if the startup script has been successfully executed.
<img src="/images/posts/qwiklabs/qwiklabs-GSP101-step3-configure-apache2-web-server-in-VM-instance.png" alt="Apache2 Debian Default Page" /></li>
</ol>
<p class="img-caption">Fig. The Apache web server installed by the startup script</p>

<p>Congratulations! You should accomplish the lab if you follow all the above steps.</p>

<p>This post has also been published to Medium. If you like to read and take notes in Medium, please visit <a href="https://medium.com/@chriskyfung/qwiklab-logbook-deploy-a-compute-instance-with-a-remote-startup-script-2300f5aecc16">Medium (@chriskyfung)</a>.</p>

<hr />

<p>With the GCP web console, you can to set up a VM instance as a web server without touch any codes. In this lab, you also automate the installation of web server packages using a startup script. But if you need to repeatedly deploy cloud resources more systematically, you go for Cloud Deployment Manager. <a href="/blog/qwiklabs/Configure-a-Firewall-and-a-Startup-Script-with-Deployment-Manager">Next lab</a> tests your proficiency of building a deployment template for creating a VM instance with appropriate firewall rule for HTTP traffic.</p>

<p><strong>Related posts:</strong></p>

<ul>
  <li>
    <p><em><a href="/blog/qwiklabs/Qwiklabs-User-Tips-for-Learning_Google_Cloud_Platform">Learning Google Cloud Platform on Qwiklabs: Learning Map, Assistive Tool and Tips</a></em></p>
  </li>
  <li>
    <p><em><a href="/blog/qwiklabs/Google-Cloud-Essential-Skills-Challenge-Lab">Qwiklab/Logbook: Google Cloud Essential Skills: Challenge Lab</a></em></p>
  </li>
</ul>

</div>

<!-- Post info -->
<div class="noteinfo">
<!-- include some categories and tags maybe? -->
</div>

<hr>

<!-- Post comments -->


<!-- Disqus comments -->
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "https://chriskyfung.github.io//blog/qwiklabs/Deploy-a-Compute-Instance-with-a-Remote-Startup-Script";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "https://chriskyfung.github.io//blog/qwiklabs/Deploy-a-Compute-Instance-with-a-Remote-Startup-Script"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://chriskyfung.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


	</section>
	<aside id="sidebar">
  
  
  
  <h2><i class='far fa-newspaper'></i> <a href="/blog/index.html">Blog</a></h2>
  <h3><a href="/blog/categories.html">Categories</a></h3>
  <h3><a href="/blog/tags.html">Tags</a></h3>
  <ul>    
    <li><h3><a href="/tag/Qwiklabs">Qwiklabs Tools & Logbooks</a></h3></li>
    <li><h3><a href="/tag/Tumblr">For Tumblr Developer</a></h3></li>
    <li><h3><a href="/tag/MATLAB">MATLAB Tips</a></h3></li>
  </ul>
  <h2><i class='fab fa-youtube'></i> <a href="https://www.youtube.com/channel/UCp0xYv7zaQmAj77GcU-msJg">YouTube Channels</a></h2>
  <ul><li><h3><a href="https://www.youtube.com/channel/UCp0xYv7zaQmAj77GcU-msJg" target="_blank">Chris's Research Channel</a></h3></li>
    <li><h3><a href='https://www.youtube.com/channel/UCGlT2itihZuRxMckNcfcA3A'>Craftweeks Channel</a></h3></li>
  </ul>
  
  <h2>&nbsp;<a href="https://www.paypal.me/chrisfungky/50" target="_blank"><button class="round">Give me a help <i class='fas fa-donate'></i></button></a></h2>
  
  <h2><i class='fas fa-gift'></i> <a href="https://invitation.codes/u/qgcUCyqa" target="_blank">Promo Codes</a></h2>
  
  <!-- Copyscape Banner -->
  <div id="copyscape-banner"><a href="http://www.copyscape.com/"><img src="//banners.copyscape.com/img/copyscape-banner-white-130x46.png" width="130" height="46" border="0" alt="Protected by Copyscape" title="Protected by Copyscape - Do not copy content from this page." /></a></div>

  <!-- Google Adsense -->  
  <script data-ad-client="ca-pub-4819282024314540" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- github_resp_sidebar -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4819282024314540"
     data-ad-slot="1391498756"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  
  <!-- Affiliate Disclouse -->
  <div id="vig-disclose"><a href="https://www.viglink.com/legal/disclosures/users?vgtag=badge"><img alt="VigLink badge" height="60" src="https://www.viglink.com/images/badges/120x60.png" title="Links monetized by VigLink" width="120"/></a></div>
</aside>

	</div>
    </div>  

    <footer>   
    <div class="invitation-codes invitation-codes-badge1" data-type="badge1" data-product="" style="float:left;"><a class="" href="https://invitation.codes/" data-type="badge1">Use my referral codes</a></div>
<script async defer src="//invitation.codes/embed/user/qgcUCyqa/embed.js"></script>

    <div id="footer-copyright">&copy; 2014-2020 Chris KY FUNG. All rights reserved</div>
    <div id="footer-powered">Powered by <a href="https://pages.github.com">GitHub Pages</a></div>
</footer>

	
    
      <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-72575541-9"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-72575541-9');
	</script>
    
    
    <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5d01c83d522ad580"></script>
    <script type="text/javascript">
  var vglnk = {key: '56a8cde8bc46ec169ed23320c0e35c68'};
  (function(d, t) {
      var s = d.createElement(t);
          s.type = 'text/javascript';
          s.async = true;
          s.src = '//cdn.viglink.com/api/vglnk.js';
      var r = d.getElementsByTagName(t)[0];
          r.parentNode.insertBefore(s, r);
  }(document, 'script'));
</script>
	  
  </body>
</html>

