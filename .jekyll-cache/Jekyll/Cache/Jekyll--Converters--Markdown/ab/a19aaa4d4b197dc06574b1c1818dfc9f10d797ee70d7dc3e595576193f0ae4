I"à"<!--more-->

<p>If you read my <a href="/blog/qwiklabs/Google-Cloud-Essential-Skills-Challenge-Lab">last post</a>, you should know how to manually create a VM instance and configure it as an Apache2 web server with the web console in Google Cloud Platform (GCP). The steps are easy but you can automate and scale your web server installation process by adopting a <strong>Startup Script</strong>. Loading the startup script remotely from a cloud storage bucket is one method. The second lab of the challenge quest, <strong>GSP301</strong> <em>â€œ<a href="https://www.qwiklabs.com/focuses/1735?parent=catalog">Deploy a Compute Instance with a Remote Startup Script</a>â€œ</em>, is to test if you can deploy an Apache server to a VM instance with a remote startup script. You must know how to create a bucket and upload files to Google Cloud Storage, and configure the metadata in the dialog of creating an instance.</p>

<h2 id="brief-introduction-of-challenge-scenario">Brief Introduction of Challenge Scenario</h2>

<p>When you open the page of this lab in Qwiklabs, you can find the task requirements by click the green activity tracker (on the top right of the page) to expand the score box.</p>

<p><img src="/images/posts/qwiklabs/score_box_of_qwiklabs_GSP301.png" alt="Screenshot of Green Score box of Qwiklabs Hands-on-lab GSP301" /></p>
<p class="img-caption">Fig. Screenshot of Qwiklabs hands-on-lab GSP301 scorebox
</p>

<p>The screenshot above shows that there are 4 steps required for completing this lab. Combining with the instruction details, they are translated to the following mission statements.</p>

<ol>
  <li>
    <p>Create a Google Cloud Storage bucket, and confirm that the bucket contains a file.</p>
  </li>
  <li>
    <p>Create a Linux virtual machine that runs a remote startup script called <code class="highlighter-rouge">install-web.sh</code>  from cloud storage.</p>
  </li>
  <li>
    <p>Confirm that an HTTP access firewall rule exists with tag that applies to that virtual machine.</p>
  </li>
  <li>
    <p>Confirm the web server can be connected using HTTP and get a non-error response.</p>
  </li>
</ol>

<p><br /></p>

<p><img src="/images/posts/qwiklabs/qwiklab-GSP301-schematic.png" alt="Schematic diagram of Qwiklabs GSP301: Deploy a Compute Instance with a Remote Startup Script" /></p>
<p class="img-caption">Fig. Schematic diagram of GSP301: Deploy a Compute Instance with a Remote Startup Script</p>

<p><br /></p>

<h2 id="download-sample-startup-script">Download Sample Startup Script</h2>

<p>First of all, find <strong>Sample Startup Script</strong> below the Start button and the timer of the lab. Then, download the startup script file to your computer. This lab requires a minute for provisioning lab resources. You may make use of this interval to download the file or take a drink.</p>

<p><img src="/images/posts/qwiklabs/qwiklabs-GSP301-download-startup-script-file.png" alt="download sample startup script below the qwiklabs start button and lab timer" /></p>
<p class="img-caption">Fig. Download sample startup script below the Qwiklabs start button and lab timer</p>

<h2 id="upload-the-startup-script-to-a-cloud-storage-bucket">Upload the Startup Script to a Cloud Storage Bucket</h2>

<ol>
  <li>In the web console, navigate to <strong><em>Storage</em></strong>.</li>
  <li>Create a bucket with a unique bucket name.</li>
  <li>Upload the <code class="highlighter-rouge">install-web.sh</code> file to the bucket.</li>
  <li>
    <p>Make the file publicly accessible (This ensures the file can be access by the VM instance deployed soon).
 <br /><img src="/images/posts/qwiklabs/qwiklabs-GSP301-edit-file-permission-in-GCP-storage-bucket.png" alt="Edit the file permissions in Cloud Storage using GCP web console" /><br />
 Click the three dots (<i class="fas fa-ellipsis-v"></i>) icon at the right end of the filename. Choose <strong><em>Edit permissions</em></strong> in the dropdown menu.<br />
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-add-allusers-read-permission-to-install-web-sh.png" alt="Add allUsers and Reader access to the file" /><br />
Add a new <strong>User</strong>, type <code class="highlighter-rouge">allUsers</code> to the name field, and choose <strong>Reader</strong>.<br />
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-make-install-web-sh-publicly-accessible.png" alt="Confirm the install-web.sh file become pubilcly accessible" /><br /></p>
  </li>
  <li>Click the filename and copy the URL, i.e. <code class="highlighter-rouge">gs://.../install-web.sh</code> for later use.<br /><img src="/images/posts/qwiklabs/qwiklabs-GSP301-obtain-gs-url-startup-script-file.png" alt="Object details in Cloud Storage" /></li>
</ol>
<p class="img-caption">Fig. Confirm the startup script file become pubilcly accessible</p>

<h2 id="configure-metadata-in-creating-vm-instance">Configure Metadata in Creating VM instance</h2>

<ol>
  <li>Go to <strong><em>Compute Engine</em></strong>, create a new VM instance.</li>
  <li>Select <code class="highlighter-rouge">Allow HTTP traffic</code> under the Firewall section.
<img src="/images/posts/qwiklabs/qwiklabs-GSP101-step2-allow-HTTP-traffic-in-firewall-setting.png" alt="Firewall rule setting for creating a VM instance" /></li>
  <li>Expand <strong>Management, security, disks, networking, sole tenancy</strong>.</li>
  <li>In the Metadata section, add <code class="highlighter-rouge">startup-script-url</code> and paste the URL of the script file as the key value.
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-configure-startup-script-url-to-metadata.png" alt="Configure a remote startup script url to the metadata in Crate a VM instance page" />
If you want to learn more, please refer <a href="https://cloud.google.com/compute/docs/startupscript">Running Startup Scripts</a> in Compute Engine Documentation.
<br /></li>
  <li>Click <strong>Create</strong> to create the instance.
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-check-progress-created-instance-1.png" alt="Successfully created instance-1" /></li>
</ol>
<p class="img-caption">Fig. The new Compute Engine, `instance-1`</p>

<h2 id="inspect-instance-correctly-running-startup-script">Inspect Instance Correctly Running Startup Script</h2>

<ol>
  <li>Wait for the new VM instance startup.</li>
  <li>Click the instance name to open its Details tab. Then, expand the Logs and click <strong>Serial port 1 (console)</strong>.
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-view-serial-port-of-created-vm-instance.png" alt="Serial port logs showing in the Details tab of instance-1" /></li>
  <li>The startup script automatically installs the Apache web server software while creating the VM instance. You should able to find the log events about downloading the startup script and installing the apache packages.
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-logs-of-serial-port-1.png" alt="Serial Log: downloading startup script" /><br /><br />
<img src="/images/posts/qwiklabs/qwiklabs-GSP301-apache-installation-in-logs-of-serial-port-1.png" alt="Serial Logs: installing Apache with startup script" /></li>
</ol>
<p class="img-caption">Fig. Logs that shows the execution of the startup script</p>

<ol>
  <li>Open the external IP in your web browser. You should view the Apache default page, if the startup script has been successfully executed.
<img src="/images/posts/qwiklabs/qwiklabs-GSP101-step3-configure-apache2-web-server-in-VM-instance.png" alt="Apache2 Debian Default Page" /></li>
</ol>
<p class="img-caption">Fig. The Apache web server installed by the startup script</p>

<p>Congratulations! You should accomplish the lab if you follow all the above steps.</p>

<p>This post has also been published to Medium. If you like to read and take notes in Medium, please visit <a href="https://medium.com/@chriskyfung/qwiklab-logbook-deploy-a-compute-instance-with-a-remote-startup-script-2300f5aecc16">Medium (@chriskyfung)</a>.</p>

<hr />

<p>With the GCP web console, you can to set up a VM instance as a web server without touch any codes. In this lab, you also automate the installation of web server packages using a startup script. But if you need to repeatedly deploy cloud resources more systematically, you go for Cloud Deployment Manager. <a href="/blog/qwiklabs/Configure-a-Firewall-and-a-Startup-Script-with-Deployment-Manager">Next lab</a> tests your proficiency of building a deployment template for creating a VM instance with appropriate firewall rule for HTTP traffic.</p>

<p><strong>Related posts:</strong></p>

<ul>
  <li>
    <p><em><a href="/blog/qwiklabs/Qwiklabs-User-Tips-for-Learning_Google_Cloud_Platform">Learning Google Cloud Platform on Qwiklabs: Learning Map, Assistive Tool and Tips</a></em></p>
  </li>
  <li>
    <p><em><a href="/blog/qwiklabs/Google-Cloud-Essential-Skills-Challenge-Lab">Qwiklab/Logbook: Google Cloud Essential Skills: Challenge Lab</a></em></p>
  </li>
</ul>
:ET